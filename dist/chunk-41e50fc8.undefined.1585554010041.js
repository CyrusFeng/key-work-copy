(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-41e50fc8"],{"6ffc":function(e,a,t){"use strict";t.r(a);var i=function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("div",{staticStyle:{height:"100%"}},[t("div",{ref:"wrapper",staticClass:"scroll-wrap",staticStyle:{height:"calc(100% - 0.45rem)",overflow:"hidden"}},[t("div",[t("div",{staticClass:"block"},[t("div",{staticClass:"title-wrap"},[t("field-title",{attrs:{"blueline-visible":!1,"redstar-visible":!1}},[e._v("完结申请")])],1),t("div",{staticClass:"text"},[t("div",{staticClass:"radio"},[t("c-radio",{attrs:{options:e.options},on:{"value-change":function(a){return e.radioOnChange(a)}}})],1),t("div",{directives:[{name:"show",rawName:"v-show",value:2===e.isFinish,expression:"isFinish === 2"}]},[t("c-textarea",{attrs:{"default-value":"",remark:"",tips:"请输入完结说明"},on:{"update:inputValue":function(a){e.explain1=a}}})],1),t("div",{directives:[{name:"show",rawName:"v-show",value:3===e.isFinish,expression:"isFinish === 3"}]},[t("c-textarea",{attrs:{"default-value":"",remark:"",tips:"点击输入现状"},on:{"update:inputValue":function(a){e.explain2=a}}}),t("c-textarea",{attrs:{"default-value":"",remark:"",tips:"点击输入未完成原因"},on:{"update:inputValue":function(a){e.explain3=a}}})],1)])]),3===e.$store.getters.currentRole?t("div",{staticClass:"block approver"},[t("div",{staticClass:"title-wrap"},[t("div",[t("field-title",{attrs:{"blueline-visible":!1,"redstar-visible":!1}},[e._v("责任人审批")])],1),t("i",{staticClass:"icon",on:{click:e.onClickToChooseCharger}})]),t("div",{staticClass:"des-wrap"},[t("div",{staticClass:"wrap"},[t("div",{staticClass:"left"},[e.chargerAvatarUrl?t("img",{attrs:{src:e.chargerAvatarUrl}}):e._e()]),t("div",{staticClass:"right"},[t("span",[e._v(e._s(e.chargerName))])])])])]):e._e(),t("div",{staticClass:"block approver"},[t("div",{staticClass:"title-wrap"},[t("div",[t("field-title",{attrs:{"blueline-visible":!1,"redstar-visible":!1}},[e._v("上级领导审批")])],1),t("i",{staticClass:"icon",on:{click:e.onClickToChooseChargersLeader}})]),t("div",{staticClass:"des-wrap"},[t("div",{staticClass:"wrap"},[t("div",{staticClass:"left"},[e.chargersLeaderAvatarUrl?t("img",{attrs:{src:e.chargersLeaderAvatarUrl}}):e._e()]),t("div",{staticClass:"right"},[t("span",[e._v(e._s(e.chargersLeaderName))])])])])])])]),t("div",{staticClass:"button-wrap"},[t("div",{staticClass:"btn2",on:{click:e.onClickToSave}},[t("span",[e._v("发送")])])]),t("image-panel",{attrs:{url:e.imageUrl,showImagePanel:e.showImagePanel},on:{"update:showImagePanel":function(a){e.showImagePanel=a},"update:show-image-panel":function(a){e.showImagePanel=a}}}),t("FullPageLoading",{attrs:{loading:e.loading}}),t("FullPageLoading",{attrs:{loading:e.loading1}}),t("FullPageLoading",{attrs:{loading:e.loading2}}),t("FullPageLoading",{attrs:{loading:e.loading3}}),t("StatePage",{attrs:{success:e.success,tipVisible:e.tipVisible,tipFailedDesc:e.tipFailedDesc,"jump-to":e.path},on:{"update:tipVisible":function(a){e.tipVisible=a}}}),t("Validator",{attrs:{source:e.source,validatorVisible:e.validatorVisible,orderType:"Flow"},on:{"update:validatorVisible":function(a){e.validatorVisible=a}}})],1)},s=[],r=(t("ac6a"),t("7f7f"),t("bc3a")),l=t.n(r),o=t("4328"),n=t.n(o),c={name:"end",data:function(){return{isFinish:2,explain1:"",explain2:"",explain3:"",options:[{label:"完成",value:2},{label:"未完成",value:3}],imageUrl:"",showImagePanel:!1,loading:!1,loading1:!1,loading2:!1,loading3:!1,urlObj:[],approverName:"",approverAvatarUrl:"",approverID:"",chargerID:"",chargerName:"",chargerAvatarUrl:"",chargersLeaderID:"",chargersLeaderName:"",chargersLeaderAvatarUrl:"",scroll:null,tipVisible:!1,success:!1,source:{},validatorVisible:!1,taskLifeList:[],path:"",tipFailedDesc:""}},beforeRouteEnter:function(e,a,t){qing.call("setWebViewTitle",{title:"完结申请"}),t(function(e){if("taskdetail"===a.name){var t=e.$route.params.detailObj;e.detailObj=t,e.detailObj&&localStorage.setItem("detailObj",JSON.stringify(e.detailObj))}else e.detailObj=JSON.parse(localStorage.getItem("detailObj"));console.log("vm.detailObj.taskLifeList",e.detailObj.taskLifeList),e.urlObj=[],e.detailObj.chargerID&&(e.loading1=!0,e.$getPersonInfoByOpenID(e.detailObj.chargerID).then(function(a){var t=a.data.result.data[0];e.chargerID=t.openId,e.chargerName=t.name,e.chargerAvatarUrl=t.photoUrl,e.loading1=!1}).catch(function(e){alert("获取责任人信息失败")})),e.detailObj.signerID&&null!==e.detailObj.signerID&&(e.loading3=!0,e.$getPersonInfoByOpenID(e.detailObj.signerID).then(function(a){var t=a.data.result.data[0];e.chargersLeaderID=t.openId,e.chargersLeaderName=t.name,e.chargersLeaderAvatarUrl=t.photoUrl,e.$store.getters.openID===e.chargersLeaderID&&(e.chargersLeaderID="",e.chargersLeaderName="",e.chargersLeaderAvatarUrl=""),e.loading3=!1}).catch(function(e){alert("获取主管领导信息失败")}))})},mounted:function(){this.$initScroll(this.scroll,this.$refs.wrapper)},beforeDestroy:function(){this.urlObj=[]},methods:{radioOnChange:function(e){this.isFinish=e,console.log(e)},onClickToChooseImage:function(){var e=this;qing.call("chooseImage",{type:"camera",needCut:!1,isMulti:!0,maxSelectCount:9,showOrigin:!1,success:function(a){a.data.localIds.forEach(function(a){qing.call("uploadImage",{localId:a,isShowProgressTips:1,success:function(a){if("true"===a.success||!0===a.success){var t=a.data.serverId;e.urlObj.push({url:"https://yunzhijia.com//openfile/download/media/".concat(t),showLoading:!0})}else alert("图片上传失败，请重试")}})})}})},onClickToChooseApprover:function(){var e=this;qing.call("selectPersons",{isMulti:!1,success:function(a){e.approverAvatarUrl=a.data.persons[0].avatarUrl,e.approverName=a.data.persons[0].name,e.approverID=a.data.persons[0].openId}})},onClickImage:function(e){this.imageUrl=e,this.showImagePanel=!0},saveData:function(){var e=[{}];if(e[0].parentID=this.detailObj.id,e[0].type=3,e[0].lifePointList=[],3===this.$store.getters.currentRole){var a={index:1};a.approverID=this.detailObj.chargerID,a.approverAvatarUrl="",a.approverName=this.detailObj.chargerName,e[0].lifePointList.push(a);var t={index:2};if(t.approverID=this.chargersLeaderID,t.approverAvatarUrl=this.chargersLeaderAvatarUrl,t.approverName=this.chargersLeaderName,this.chargersLeaderID===localStorage.getItem("chairmanId"))if(1==this.detailObj.sourceID||2==this.detailObj.sourceID||3==this.detailObj.sourceID||4==this.detailObj.sourceID||7==this.detailObj.sourceID){var i={approverID:"57c0f003e4b01de693d52384",approverName:"晏宁",approverAvatarUrl:"https://static.yunzhijia.com/space/c/photo/load?id=5e0c0d946d67ff33eb8b830d",index:2};e[0].lifePointList.push(i),t.index=3,e[0].lifePointList.push(t)}else e[0].lifePointList.push(t);else e[0].lifePointList.push(t)}else{var s={index:1};if("charge"===this.$store.state.taskType?(s.approverID=this.chargersLeaderID,s.approverAvatarUrl=this.chargersLeaderAvatarUrl,s.approverName=this.chargersLeaderName):"sign"===this.$store.state.taskType&&(s.approverID=this.$store.state.openID,s.approverAvatarUrl=this.$store.state.avatarUrl,s.approverName=this.$store.state.name),e[0].lifePointList.push(s),"charge"===this.$store.state.taskType&&this.chargersLeaderID===localStorage.getItem("chairmanId")&&(1==this.detailObj.sourceID||2==this.detailObj.sourceID||3==this.detailObj.sourceID||4==this.detailObj.sourceID||7==this.detailObj.sourceID)){var r={approverID:"57c0f003e4b01de693d52384",approverName:"晏宁",approverAvatarUrl:"https://static.yunzhijia.com/space/c/photo/load?id=5e0c0d946d67ff33eb8b830d",index:1};e[0].lifePointList[0].index=2,e[0].lifePointList.unshift(r)}}2===this.isFinish?e[0].done_type=1:3===this.isFinish&&(e[0].done_type=0),2===this.isFinish?e[0].done_info=this.explain1:3===this.isFinish&&(e[0].done_going=this.explain2,e[0].done_reason=this.explain3),this.taskLifeList=e,3===this.$store.getters.currentRole?2===this.isFinish?this.source={chargerID:this.chargerID,chargersLeaderID:this.chargersLeaderID,explain1:this.explain1}:this.source={chargerID:this.chargerID,chargersLeaderID:this.chargersLeaderID,explain2:this.explain2,explain3:this.explain3}:2===this.isFinish?this.source={chargersLeaderID:this.chargersLeaderID,explain1:this.explain1}:this.source={chargersLeaderID:this.chargersLeaderID,explain2:this.explain2,explain3:this.explain3}},onClickToSave:function(){var e=this;this.saveData(),1===this.$store.getters.currentRole?this.path="chairmanList":3===this.$store.getters.currentRole?this.path="list-clerk":4===this.$store.getters.currentRole||2===this.$store.getters.currentRole?this.path="listSourceAdmin":this.path="list",setTimeout(function(){if(!e.validatorVisible){var a=e.$url+"/taskSystem/task/life";e.loading=!0,l()({method:"post",url:a,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},data:n.a.stringify({jsonStr:JSON.stringify(e.taskLifeList)})}).then(function(a){e.loading=!1,e.tipVisible=!0,!0===a.data.success?e.success=!0:(e.tipFailedDesc=a.data.outerMessage,e.success=!1),e.urlObj=[]})}},0)},onClickToChooseCharger:function(){var e=this;qing.call("selectPersons",{isMulti:!1,success:function(a){e.chargerAvatarUrl=a.data.persons[0].avatarUrl,e.chargerName=a.data.persons[0].name,e.chargerID=a.data.persons[0].openId}})},onClickToChooseChargersLeader:function(){var e=this;qing.call("selectPersons",{isMulti:!1,success:function(a){e.chargersLeaderAvatarUrl=a.data.persons[0].avatarUrl,e.chargersLeaderName=a.data.persons[0].name,e.chargersLeaderID=a.data.persons[0].openId}})}}},d=c,h=(t("c021"),t("2877")),p=Object(h["a"])(d,i,s,!1,null,"6dc2bab8",null);a["default"]=p.exports},"9e00":function(e,a,t){},c021:function(e,a,t){"use strict";var i=t("9e00"),s=t.n(i);s.a}}]);