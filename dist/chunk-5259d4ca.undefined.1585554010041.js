(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5259d4ca"],{"6e1f":function(e,a,t){"use strict";t.r(a);var i=function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("div",{staticStyle:{height:"100%"}},[t("div",{ref:"wrapper",staticClass:"scroll-wrap",staticStyle:{height:"calc(100% - 0.45rem)",overflow:"hidden"}},[t("div",[t("div",{staticClass:"block field"},[t("div",{staticClass:"title-wrap"},[t("field-title",{attrs:{"blueline-visible":!1,"redstar-visible":!1}},[e._v(e._s(e.detailObj.projectName)+"\n                    ")]),e.detailObj&&e.detailObj.state?t("span",{staticClass:"status"},[e._v(e._s(e.getTaskStatus(e.detailObj.state)))]):e._e()],1),t("div",{staticClass:"content"},[t("div",{staticClass:"row"},[t("div",{staticClass:"top"},[t("div",{staticClass:"label"},[e._v("完成日期")]),t("div",{staticClass:"right"},[e._v(e._s(e.detailObj.endtime&&e.detailObj.endtime.split(" ")[0]))])]),t("div",{staticClass:"bottom"},[t("div",{staticClass:"label"},[e._v("变更为")]),t("div",{staticClass:"right",on:{click:function(a){e.isVisible1=!e.isVisible1}}},[t("span",[e._v(e._s(e.endtime&&e.endtime.split(" ")[0]||"请选择"))])])])]),t("div",{staticClass:"row"},[t("div",{staticClass:"top"},[t("div",{staticClass:"label"},[e._v("单位")]),t("div",{staticClass:"right"},[e._v(e._s(e.$judgeUndefined(e.detailObj.unitName)))])]),t("div",{staticClass:"bottom"},[t("div",{staticClass:"label"},[e._v("变更为")]),t("div",{staticClass:"right yunzhijia"},[t("span",[e._v(e._s(e.unitName||"请选择"))]),t("i",{staticClass:"icon",on:{click:e.onClickToChooseCompany}})])])]),t("div",{staticClass:"row"},[t("div",{staticClass:"top"},[t("div",{staticClass:"label"},[e._v("责任人")]),t("div",{staticClass:"right"},[e._v(e._s(e.$judgeUndefined(e.detailObj.chargerName)))])]),t("div",{staticClass:"bottom"},[t("div",{staticClass:"label"},[e._v("变更为")]),t("div",{staticClass:"right yunzhijia"},[t("span",[e._v(e._s(e.chargerName||"请选择"))]),t("i",{staticClass:"icon",on:{click:e.onClickToChooseCharger}})])])]),t("div",{staticClass:"row"},[t("div",{staticClass:"top"},[t("div",{staticClass:"label"},[e._v("协助人")]),t("div",{staticClass:"right"},[e._v(e._s(e.$judgeUndefined(e.changeInfoObj.before.helperName)))]),t("i",{staticClass:"icon delete-btn",on:{click:e.deleteOriginHelper}})]),t("div",{staticClass:"bottom"},[t("div",{staticClass:"label"},[e._v("变更为")]),t("div",{staticClass:"right yunzhijia clearAble"},[t("span",[e._v(e._s(e.changeInfoObj.after.helperName||"请选择"))]),t("div",{staticClass:"icon-wrap"},[t("i",{staticClass:"icon iconClear",on:{click:e.clearHelper}}),t("i",{staticClass:"icon",on:{click:e.onClickToChooseHelper}})])])])])])]),t("div",{staticClass:"block"},[t("div",{staticClass:"title-wrap"},[t("field-title",{attrs:{"blueline-visible":!1,"redstar-visible":!1}},[e._v("预期目标")])],1),t("div",{staticClass:"text"},[t("div",{staticClass:"word"},[e._v(e._s(e.$judgeUndefined(e.detailObj.aim)))]),t("c-textarea",{attrs:{"default-value":"",remark:"",tips:"请输入变更内容"},on:{"update:inputValue":function(a){e.changeInfoObj.after.aim=a}}})],1)]),t("div",{staticClass:"block"},[t("div",{staticClass:"title-wrap"},[t("field-title",{attrs:{"blueline-visible":!1,"redstar-visible":!0}},[e._v("变更原因")])],1),t("div",{staticClass:"text"},[t("c-textarea",{attrs:{"default-value":"",remark:"",tips:"请输入变更原因"},on:{"update:inputValue":function(a){e.change_reason=a}}})],1)]),"charge"===e.$store.state.taskType&&3===e.$store.getters.currentRole?t("div",{staticClass:"block approver"},[t("div",{staticClass:"title-wrap"},[t("div",[t("field-title",{attrs:{"blueline-visible":!1,"redstar-visible":!1}},[e._v("责任人审批")])],1),t("i",{staticClass:"icon",on:{click:e.onClickToChooseApprover}})]),t("div",{staticClass:"des-wrap"},[t("div",{staticClass:"wrap"},[t("div",{staticClass:"left"},[e.approverAvatarUrl?t("img",{attrs:{src:e.approverAvatarUrl}}):e._e()]),t("div",{staticClass:"right"},[t("span",[e._v(e._s(e.approverName))])])])])]):e._e(),"charge"===e.$store.state.taskType&&2!==this.$store.getters.currentRole&&4!==this.$store.getters.currentRole?t("div",{staticClass:"block approver"},[t("div",{staticClass:"title-wrap"},[t("div",[t("field-title",{attrs:{"blueline-visible":!1,"redstar-visible":!1}},[e._v("上级领导审批")])],1),t("i",{staticClass:"icon",on:{click:e.onClickToChooseChargersLeader}})]),t("div",{staticClass:"des-wrap"},[t("div",{staticClass:"wrap"},[t("div",{staticClass:"left"},[e.chargersLeaderAvatarUrl?t("img",{attrs:{src:e.chargersLeaderAvatarUrl}}):e._e()]),t("div",{staticClass:"right"},[t("span",[e._v(e._s(e.chargersLeaderName))])])])])]):e._e()])]),t("div",{staticClass:"button-wrap"},[t("div",{staticClass:"btn2",on:{click:e.onClickToSave}},[t("span",[e._v("发送")])])]),t("nut-datepicker",{attrs:{"is-visible":e.isVisible1,type:"date",title:"请选择日期","is-show-chinese":!1,defaultValue:e.today,endDate:"2199-10-05"},on:{close:function(a){return e.switchPicker("isVisible1")},choose:e.setChooseValue1}}),t("image-panel",{attrs:{url:e.imageUrl,showImagePanel:e.showImagePanel},on:{"update:showImagePanel":function(a){e.showImagePanel=a},"update:show-image-panel":function(a){e.showImagePanel=a}}}),t("StatePage",{attrs:{success:e.success,tipVisible:e.tipVisible,tipFailedDesc:e.tipFailedDesc,"jump-to":e.path},on:{"update:tipVisible":function(a){e.tipVisible=a}}}),t("FullPageLoading",{attrs:{loading:e.loading}}),t("FullPageLoading",{attrs:{loading:e.loading1}}),t("FullPageLoading",{attrs:{loading:e.loading2}}),t("FullPageLoading",{attrs:{loading:e.loading3}}),t("Validator",{attrs:{source:e.source,validatorVisible:e.validatorVisible},on:{"update:validatorVisible":function(a){e.validatorVisible=a}}})],1)},s=[],r=(t("a481"),t("28a5"),t("ac6a"),t("7f7f"),t("e0eb")),n=t("bc3a"),o=t.n(n),l=t("4328"),c=t.n(l),h=[{url:"https://tva1.sinaimg.cn/large/006y8mN6ly1g6nig61wg9j308w064tax.jpg"},{url:"https://tva1.sinaimg.cn/large/006y8mN6ly1g6nig61wg9j308w064tax.jpg"},{url:"https://tva1.sinaimg.cn/large/006y8mN6ly1g6nig61wg9j308w064tax.jpg"},{url:"https://tva1.sinaimg.cn/large/006y8mN6ly1g6nig61wg9j308w064tax.jpg"},{url:"https://tva1.sinaimg.cn/large/006y8mN6ly1g6niksccotj30ku112acg.jpg"},{url:"https://tva1.sinaimg.cn/large/006y8mN6ly1g6niksccotj30ku112acg.jpg"},{url:"https://tva1.sinaimg.cn/large/006y8mN6ly1g6nig61wg9j308w064tax.jpg"},{url:"https://tva1.sinaimg.cn/large/006y8mN6ly1g6nig61wg9j308w064tax.jpg"},{url:"https://tva1.sinaimg.cn/large/006y8mN6ly1g6nig61wg9j308w064tax.jpg"}],d={name:"change",data:function(){return{urlObj:h,isVisible1:!1,scroll:null,loading:!1,loading1:!1,loading2:!1,loading3:!1,tipVisible:!1,success:!1,imageUrl:void 0,showImagePanel:!1,today:r["a"].getYearMonthDayString(new Date),endtime:"",unitName:"",unitID:"",chargerID:"",chargerName:"",chargerAvatarUrl:"",chargersLeaderID:"",chargersLeaderName:"",chargersLeaderAvatarUrl:"",helperID:"",helperName:"",aim:"",change_reason:"",detailObj:{},approverID:"",approverName:"",approverAvatarUrl:"",source:{},validatorVisible:!1,taskLifeList:[],path:"",tipFailedDesc:"",changeInfoObj:{before:{endtime:"",unitID:"",unitName:"",chargerID:"",chargerName:"",helperID:"",helperName:"",aim:""},after:{endtime:"",unitID:"",unitName:"",chargerID:"",chargerName:"",helperID:"",helperName:"",aim:""}}}},beforeRouteEnter:function(e,a,t){qing.call("setWebViewTitle",{title:"变更"}),t(function(e){if("taskdetail"===a.name){var t=e.$route.params.detailObj;console.log(t),e.detailObj=t,e.detailObj&&localStorage.setItem("detailObj",JSON.stringify(e.detailObj))}else e.detailObj=JSON.parse(localStorage.getItem("detailObj"));e.changeInfoObj.before.endtime=e.detailObj.endtime,e.changeInfoObj.before.unitID=e.detailObj.unitID,e.changeInfoObj.before.unitName=e.detailObj.unitName,e.changeInfoObj.before.chargerID=e.detailObj.chargerID,e.changeInfoObj.before.chargerName=e.detailObj.chargerName,e.changeInfoObj.before.helperID=e.detailObj.helperID,e.changeInfoObj.before.helperName=e.detailObj.helperName,e.changeInfoObj.before.aim=e.detailObj.aim,e.changeInfoObj.after.endtime=e.detailObj.endtime,e.changeInfoObj.after.unitID=e.detailObj.unitID,e.changeInfoObj.after.unitName=e.detailObj.unitName,e.changeInfoObj.after.chargerID=e.detailObj.chargerID,e.changeInfoObj.after.chargerName=e.detailObj.chargerName,e.changeInfoObj.after.helperID=e.detailObj.helperID,e.changeInfoObj.after.helperName=e.detailObj.helperName,e.changeInfoObj.after.aim=e.detailObj.aim,console.log("vm.detailObj.taskLifeList",e.detailObj.taskLifeList),e.urlObj=[],e.detailObj.imgs&&e.detailObj.imgs.split(",").forEach(function(a){e.urlObj.push({url:a,showLoading:!0})}),e.detailObj.chargerID&&(e.loading1=!0,e.$getPersonInfoByOpenID(e.detailObj.chargerID).then(function(a){var t=a.data.result.data[0];e.approverID=t.openId,e.approverName=t.name,e.approverAvatarUrl=t.photoUrl,e.loading1=!1}).catch(function(e){alert("获取责任人信息失败")})),console.log("vm.detailObj.signerID",e.detailObj.signerID),e.detailObj.signerID&&null!==e.detailObj.signerID&&(e.loading3=!0,e.$getPersonInfoByOpenID(e.detailObj.signerID).then(function(a){var t=a.data.result.data[0];e.chargersLeaderID=t.openId,e.chargersLeaderName=t.name,e.chargersLeaderAvatarUrl=t.photoUrl,e.$store.getters.openID===e.chargersLeaderID&&(e.chargersLeaderID="",e.chargersLeaderName="",e.chargersLeaderAvatarUrl=""),e.loading3=!1}).catch(function(e){alert("获取主管领导信息失败")}))})},mounted:function(){this.$initScroll(this.scroll,this.$refs.wrapper)},beforeDestroy:function(){this.urlObj=[]},methods:{getTaskStatus:function(e){switch(e){case 0:this.state="暂存";break;case 1:this.state="新增";break;case 2:this.state="进行中";break;case 3:this.state="已完成";break;case 4:this.state="已废止";break;default:this.state="";break}return this.state},onClickToChooseImage:function(){var e=this;qing.call("chooseImage",{type:"camera",needCut:!1,isMulti:!0,maxSelectCount:9,showOrigin:!1,success:function(a){a.data.localIds.forEach(function(a){qing.call("uploadImage",{localId:a,isShowProgressTips:1,success:function(a){if("true"===a.success||!0===a.success){var t=a.data.serverId;e.urlObj.push({url:"https://yunzhijia.com//openfile/download/media/".concat(t),showLoading:!0})}else alert("图片上传失败，请重试")}})})}})},onClickToChooseApprover:function(){var e=this;qing.call("selectPersons",{isMulti:!1,success:function(a){e.approverAvatarUrl=a.data.persons[0].avatarUrl,e.approverName=a.data.persons[0].name,e.approverID=a.data.persons[0].openId}})},switchPicker:function(e){console.log(222),this["".concat(e)]=!this["".concat(e)],console.log(this["".concat(e)])},setChooseValue1:function(e){this.endtime=e[3],this.endtime&&this.detailObj.starttime&&(this.compareDate(this.endtime,this.detailObj.starttime)?this.endtime=r["a"].getYearMonthDayHMSString(new Date(e[3]),"end"):(alert("完成时间必须大于开始时间"),this.endtime=void 0)),this.changeInfoObj.after.endtime=this.endtime},compareDate:function(e,a){if(!e)return!1;if(!a)return!1;"string"===typeof e&&(e=e.replace(/-/g,"/")),"string"===typeof a&&(a=a.replace(/-/g,"/"));var t=new Date(e);t.setHours(0,0,0);var i=new Date(a);return t.getTime()>i.getTime()},onClickToChooseCompany:function(){var e=this;qing.call("selectOrgs",{isMulti:!1,success:function(a){e.unitID=a.data.orgs[0].orgId,e.unitName=a.data.orgs[0].orgName,e.changeInfoObj.after.unitID=e.unitID,e.changeInfoObj.after.unitName=e.unitName}})},onClickToChooseHelper:function(){var e=this,a=[],t=[];qing.call("selectPersons",{isMulti:!0,success:function(i){i.data.persons.forEach(function(e){a.push(e.openId),t.push(e.name)}),e.helperID=a.join(","),e.helperName=t.join(","),e.changeInfoObj.after.helperID=e.helperID,e.changeInfoObj.after.helperName=e.helperName}})},clearHelper:function(){this.helperID=void 0,this.helperName=void 0,this.changeInfoObj.after.helperID=void 0,this.changeInfoObj.after.helperName=void 0},deleteOriginHelper:function(){this.helperID="",this.helperName="",this.changeInfoObj.before.helperID="未设置",this.changeInfoObj.before.helperName="未设置"},saveData:function(){this.changeInfoObj.before.endtime===this.changeInfoObj.after.endtime&&(this.changeInfoObj.before.endtime=void 0,this.changeInfoObj.after.endtime=void 0),this.changeInfoObj.before.unitID===this.changeInfoObj.after.unitID&&(this.changeInfoObj.before.unitID=void 0,this.changeInfoObj.after.unitID=void 0,this.changeInfoObj.before.unitName=void 0,this.changeInfoObj.after.unitName=void 0),this.changeInfoObj.before.chargerID===this.changeInfoObj.after.chargerID&&(this.changeInfoObj.before.chargerID=void 0,this.changeInfoObj.after.chargerID=void 0,this.changeInfoObj.before.chargerName=void 0,this.changeInfoObj.after.chargerName=void 0),this.changeInfoObj.before.helperID===this.changeInfoObj.after.helperID&&(this.changeInfoObj.before.helperID=void 0,this.changeInfoObj.after.helperID=void 0,this.changeInfoObj.before.helperName=void 0,this.changeInfoObj.after.helperName=void 0),this.changeInfoObj.before.aim===this.changeInfoObj.after.aim&&(this.changeInfoObj.before.aim=void 0,this.changeInfoObj.after.aim=void 0);var e,a=[{}];if(a[0].parentID=this.detailObj.id,a[0].type=2,a[0].lifePointList=[],3===this.$store.getters.currentRole){var t={index:1};t.approverID=this.detailObj.chargerID,t.approverAvatarUrl=this.approverAvatarUrl,t.approverName=this.detailObj.chargerName,a[0].lifePointList.push(t);var i={index:2};if(i.approverID=this.chargersLeaderID,i.approverAvatarUrl=this.chargersLeaderAvatarUrl,i.approverName=this.chargersLeaderName,this.chargersLeaderID===localStorage.getItem("chairmanId"))if(1==this.detailObj.sourceID||2==this.detailObj.sourceID||3==this.detailObj.sourceID||4==this.detailObj.sourceID||7==this.detailObj.sourceID){var s={approverID:"57c0f003e4b01de693d52384",approverName:"晏宁",approverAvatarUrl:"https://static.yunzhijia.com/space/c/photo/load?id=5e0c0d946d67ff33eb8b830d",index:2};a[0].lifePointList.push(s),i.index=3,a[0].lifePointList.push(i)}else a[0].lifePointList.push(i);else a[0].lifePointList.push(i)}else if(2===this.$store.getters.currentRole||4===this.$store.getters.currentRole){var r={index:1};r.approverID=this.$store.state.openID,r.approverAvatarUrl=this.$store.state.avatarUrl,r.approverName=this.$store.state.name,a[0].lifePointList.push(r)}else{var n={index:1};if("charge"===this.$store.state.taskType?(n.approverID=this.chargersLeaderID,n.approverAvatarUrl=this.chargersLeaderAvatarUrl,n.approverName=this.chargersLeaderName):"sign"===this.$store.state.taskType&&(n.approverID=this.$store.state.openID,n.approverAvatarUrl=this.$store.state.avatarUrl,n.approverName=this.$store.state.name),a[0].lifePointList.push(n),"charge"===this.$store.state.taskType&&this.chargersLeaderID===localStorage.getItem("chairmanId")&&(1==this.detailObj.sourceID||2==this.detailObj.sourceID||3==this.detailObj.sourceID||4==this.detailObj.sourceID||7==this.detailObj.sourceID)){var o={approverID:"57c0f003e4b01de693d52384",approverName:"晏宁",approverAvatarUrl:"https://static.yunzhijia.com/space/c/photo/load?id=5e0c0d946d67ff33eb8b830d",index:1};a[0].lifePointList[0].index=2,a[0].lifePointList.unshift(o)}}a[0].change_info=JSON.stringify(this.changeInfoObj),a[0].change_reason=this.change_reason,this.taskLifeList=a,e=this.changeInfoObj.after.chargerID===this.changeInfoObj.before.chargerID&&this.changeInfoObj.after.unitID===this.changeInfoObj.before.unitID&&this.changeInfoObj.after.endtime===this.changeInfoObj.before.endtime&&this.changeInfoObj.after.helperID===this.changeInfoObj.before.helperID&&this.changeInfoObj.after.aim===this.changeInfoObj.before.aim?void 0:1,"sign"===this.$store.getters.taskType?this.source={change_reason:this.change_reason,after:e}:3===this.$store.getters.currentRole?this.source={change_reason:this.change_reason,approverID:this.approverID,chargersLeaderID:this.chargersLeaderID,after:e}:2===this.$store.getters.currentRole||4===this.$store.getters.currentRole?this.source={change_reason:this.change_reason,after:e}:1==this.$store.getters.currentRole&&"7"==this.detailObj.sourceID?this.source={change_reason:this.change_reason,after:e}:this.source={change_reason:this.change_reason,chargersLeaderID:this.chargersLeaderID,after:e}},onClickToSave:function(){var e=this;this.saveData(),1===this.$store.getters.currentRole?this.path="chairmanList":3===this.$store.getters.currentRole?this.path="list-clerk":4===this.$store.getters.currentRole||2===this.$store.getters.currentRole?this.path="listSourceAdmin":this.path="list",setTimeout(function(){if(!e.validatorVisible){var a=e.$url+"/taskSystem/task/life";e.loading=!0,o()({method:"post",url:a,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},data:c.a.stringify({jsonStr:JSON.stringify(e.taskLifeList)})}).then(function(a){e.loading=!1,e.tipVisible=!0,!0===a.data.success?e.success=!0:(e.tipFailedDesc=a.data.outerMessage,e.success=!1)})}},0)},onClickToChooseCharger:function(){var e=this;qing.call("selectPersons",{isMulti:!1,success:function(a){e.chargerAvatarUrl=a.data.persons[0].avatarUrl,e.chargerName=a.data.persons[0].name,e.chargerID=a.data.persons[0].openId,e.changeInfoObj.after.chargerID=e.chargerID,e.changeInfoObj.after.chargerName=e.chargerName}})},onClickToChooseChargersLeader:function(){var e=this;qing.call("selectPersons",{isMulti:!1,success:function(a){e.chargersLeaderAvatarUrl=a.data.persons[0].avatarUrl,e.chargersLeaderName=a.data.persons[0].name,e.chargersLeaderID=a.data.persons[0].openId}})}}},g=d,p=(t("f092"),t("2877")),f=Object(p["a"])(g,i,s,!1,null,"2354cd19",null);a["default"]=f.exports},8232:function(e,a,t){},f092:function(e,a,t){"use strict";var i=t("8232"),s=t.n(i);s.a}}]);